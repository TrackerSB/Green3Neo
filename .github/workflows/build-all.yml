name: Build project
on: [push]
jobs:
  Build-All:
    runs-on: ubuntu-latest
    # services:
    #   postgres:
    #     image: postgres
    #     env:
    #       POSTGRES_HOST: postgres
    #       POSTGRES_USER: testuser
    #       POSTGRES_PASSWORD: prettySafePassword
    #     options: >-
    #       --health-cmd pg_isready
    #       --health-interval 10s
    #       --health-timeout 5s
    #       --health-retries 5
    #     ports:
    #       - 5432:5432
    steps:
      - name: Install just command runner
        uses: extractions/setup-just@v2
      - name: Install diesel_cli
        run: cargo install diesel_cli --no-default-features --features "postgres"
      - name: Install diesel_cli_ext
        run: cargo install diesel_cli_ext
      - name: Clone repository
        uses: actions/checkout@v4
      - name: Load environment variables
        uses: xom9ikk/dotenv@v2.3.0
        with:
          path: ${{ github.workspace }}/green3neo
      # - name: Load environment variables
      #   uses: falti/dotenv-action@v1.1.2
      #   with:
      #     path: ${{ github.workspace }}/green3neo/.env
      #     log-variables: true
      #     export-variables: true
      #     keys-case: upper
      - name: Setup PostgreSQL server
        uses: Daniel-Marynicz/postgresql-action@master
        with:
          postgres_db:  ${{ env.DB_NAME }}
          postgres_user: ${{ env.DB_USER }}
          postgres_password: ${{ env.DB_PASSWORD }}
      - name: Execute full build
        working-directory: ${{ github.workspace }}/green3neo
        run: just build
